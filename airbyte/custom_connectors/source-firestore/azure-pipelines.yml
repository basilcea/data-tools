trigger:
  branches:
    include:
      - main
      - qa
      - airbyte
  paths:
    include:
      - 'airbyte/custom_connectors/source-firestore/*'

name: airbyte-firestore

stages:
- stage: Build
  displayName: Build and publish stage
  jobs:
  - job: Build
    displayName: Build job
    steps:
    - task: DockerInstaller@0
      inputs:
        dockerVersion: '17.09.0-ce'
    - task: Docker@2
      displayName: Login to Azure registry
      inputs:
        containerRegistry: azurecr-oaf
        command: "login"
    - task: Docker@2
      displayName: Build and publish image to Azure Container Registry
      inputs:
        command: buildAndPush
        containerRegistry: azurecr-oaf
        repository: oneacrefund/airbyte-firestore
        dockerfile: '$(Build.SourcesDirectory)/airbyte/custom_connectors/source-firestore/Dockerfile'
        tags: v1.4.3
