trigger:
  branches:
    include:
      - main
      - qa
  paths:
    include:
      - 'airflow/custom_image/*'

name: airflow

stages:
- stage: Build
  displayName: Build and publish stage
  jobs:
  - job: Build
    displayName: Build job
    steps:
    - task: DockerInstaller@0
      inputs:
        dockerVersion: '17.09.0-ce'
    - task: Docker@2
      displayName: Login to Azure registry
      inputs:
        containerRegistry: azurecr-oaf
        command: 'login'
    - task: Docker@2
      displayName: Build and publish image to Azure Container Registry
      inputs:
        command: buildAndPush
        containerRegistry: azurecr-oaf
        repository: airflow
        dockerfile: '$(Build.SourcesDirectory)/airflow/custom_image/Dockerfile'
        tags: 1.0.0

