{
  "name": "KenyaGeospatialPipeline",
  "nodes": [
    {
      "parameters": {
        "formId": "anwWsiFs9HwrPuLtdg7uQ3",
        "formatOptions": {}
      },
      "id": "c0962bd1-5282-44db-a455-2cd7659cd34a",
      "name": "ReadFromKobo",
      "type": "n8n-nodes-base.koBoToolboxTrigger",
      "typeVersion": 1,
      "position": [
        60,
        840
      ],
      "webhookId": "d83327da-78c4-42ae-8d52-0e7b39fe479f",
      "credentials": {
        "koBoToolboxApi": {
          "id": "39",
          "name": "KoBoToolbox Token account"
        }
      }
    },
    {
      "parameters": {},
      "id": "b46ad1ee-108e-4c72-8d5c-1261a72a732d",
      "name": "No Operation, do nothing",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        1520,
        560
      ]
    },
    {
      "parameters": {
        "table": "LANDING.KOBO.KENYA_HOUSEHOLD_SITE_BATCHED",
        "columns": "Id, StartTime,EndTime, Username, Region,District,Location,FirstName,MiddleName,LastName,IDNumber,PhoneNumber,Seedlings,Crops,OtherCrops,SubmissionTime, AcreAge,SubmittedBy,HouseGeopoint,SiteBoundaries,SiteAreaByFo"
      },
      "id": "f792d12f-647b-4c72-b48b-d0cc56ec7672",
      "name": "Snowflake",
      "type": "n8n-nodes-base.snowflake",
      "typeVersion": 1,
      "position": [
        1020,
        580
      ],
      "credentials": {
        "snowflake": {
          "id": "40",
          "name": "Snowflake account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "Truncate table LANDING.KOBO.KENYA_HOUSEHOLD_SITE_BATCHED;"
      },
      "id": "503241a0-44b9-44f4-a9c2-65abd89a78b9",
      "name": "Truncate Snowflake Table",
      "type": "n8n-nodes-base.snowflake",
      "typeVersion": 1,
      "position": [
        0,
        580
      ],
      "credentials": {
        "snowflake": {
          "id": "40",
          "name": "Snowflake account"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 0 * * sun"
            }
          ]
        }
      },
      "id": "a6a2d326-4ee4-42e7-87d2-d86f44abefb2",
      "name": "Run Weekly",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [
        -240,
        580
      ]
    },
    {
      "parameters": {
        "formId": "anwWsiFs9HwrPuLtdg7uQ3",
        "limit": "={{ 10000000000 }}",
        "options": {}
      },
      "id": "7bb57d3d-8556-4bd3-86e1-58426f58b286",
      "name": "Get Geospatial data from Kobo",
      "type": "n8n-nodes-base.koBoToolbox",
      "typeVersion": 1,
      "position": [
        260,
        580
      ],
      "credentials": {
        "koBoToolboxApi": {
          "id": "39",
          "name": "KoBoToolbox Token account"
        }
      }
    },
    {
      "parameters": {
        "batchSize": 1000,
        "options": {}
      },
      "id": "b693c52d-709f-4e75-b9e3-408896dd12a5",
      "name": "Load in 1000 rows per batch",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 1,
      "position": [
        500,
        580
      ]
    },
    {
      "parameters": {
        "keepOnlySet": true,
        "values": {
          "number": [
            {
              "name": "Id",
              "value": "={{ $json[\"_id\"] }}"
            }
          ],
          "string": [
            {
              "name": "Country",
              "value": "KENYA"
            },
            {
              "name": "StartTime",
              "value": "={{ $json[\"start\"] }}"
            },
            {
              "name": "EndTime",
              "value": "={{ $json[\"end\"] }}"
            },
            {
              "name": "Username",
              "value": "={{ $json[\"username\"] }}"
            },
            {
              "name": "Region",
              "value": "={{ $json[\"SECTION_2_SiteDetails/Region\"] }}"
            },
            {
              "name": "District",
              "value": "={{ $json[\"SECTION_2_SiteDetails/District\"] }}"
            },
            {
              "name": "Location",
              "value": "={{ $json[\"SECTION_2_SiteDetails/location\"] }}"
            },
            {
              "name": "FirstName",
              "value": "={{ $json[\"SECTION_3_FarmerDetails/f_names\"] }}"
            },
            {
              "name": "MiddleName",
              "value": "={{ $json[\"SECTION_3_FarmerDetails/m_name\"] }}"
            },
            {
              "name": "LastName",
              "value": "={{ $json[\"SECTION_3_FarmerDetails/l_name\"] }}"
            },
            {
              "name": "IDNumber",
              "value": "={{ $json[\"SECTION_3_FarmerDetails/id_number\"] }}"
            },
            {
              "name": "PhoneNumber",
              "value": "={{ $json[\"SECTION_3_FarmerDetails/phoneNumber\"] }}"
            },
            {
              "name": "Seedlings",
              "value": "={{ $json[\"SECTION_3_FarmerDetails/seedlings\"] }}"
            },
            {
              "name": "Crops",
              "value": "={{ $json[\"SECTION_3_FarmerDetails/crops\"] }}"
            },
            {
              "name": "OtherCrops",
              "value": "={{ $json[\"SECTION_3_FarmerDetails/otherCrops\"] }}"
            },
            {
              "name": "SubmissionTime",
              "value": "={{ $json[\"_submission_time\"] }}"
            },
            {
              "name": "AcreAge",
              "value": "={{ $json[\"SECTION_3_FarmerDetails/acreage\"] }}"
            },
            {
              "name": "SubmittedBy",
              "value": "={{ $json[\"_submitted_by\"] }}"
            },
            {
              "name": "HouseGeopoint",
              "value": "={{ $json[\"SECTION_3_FarmerDetails/house_geopoint\"] }}"
            },
            {
              "name": "SiteBoundaries",
              "value": "={{ $json[\"Geo_Location_Visualization/SiteBoundaries\"] }}"
            },
            {
              "name": "SiteAreaByFo",
              "value": "={{ $json[\"Geo_Location_Visualization/siteAreaByFo\"] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "04132be4-2950-4f76-aba0-9b691f8bdf63",
      "name": "Rename Keys and Set Needed Colums",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [
        760,
        580
      ]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value2": "={{$node[\"SplitInBatches\"].context[\"noItemsLeft\"]}}"
            }
          ]
        }
      },
      "id": "aece54ba-6c20-4e4d-b2e6-26434f209fe5",
      "name": "Check if there is no item left",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1280,
        580
      ]
    },
    {
      "parameters": {
        "keepOnlySet": true,
        "values": {
          "number": [
            {
              "name": "Id",
              "value": "={{ $json[\"_id\"] }}"
            }
          ],
          "string": [
            {
              "name": "Country",
              "value": "KENYA"
            },
            {
              "name": "StartTime",
              "value": "={{ $json[\"start\"] }}"
            },
            {
              "name": "EndTime",
              "value": "={{ $json[\"end\"] }}"
            },
            {
              "name": "Username",
              "value": "={{ $json[\"username\"] }}"
            },
            {
              "name": "Region",
              "value": "={{ $json[\"SECTION_2_SiteDetails/Region\"] }}"
            },
            {
              "name": "District",
              "value": "={{ $json[\"SECTION_2_SiteDetails/District\"] }}"
            },
            {
              "name": "Location",
              "value": "={{ $json[\"SECTION_2_SiteDetails/location\"] }}"
            },
            {
              "name": "FirstName",
              "value": "={{ $json[\"SECTION_3_FarmerDetails/f_names\"] }}"
            },
            {
              "name": "MiddleName",
              "value": "={{ $json[\"SECTION_3_FarmerDetails/m_name\"] }}"
            },
            {
              "name": "LastName",
              "value": "={{ $json[\"SECTION_3_FarmerDetails/l_name\"] }}"
            },
            {
              "name": "IDNumber",
              "value": "={{ $json[\"SECTION_3_FarmerDetails/id_number\"] }}"
            },
            {
              "name": "PhoneNumber",
              "value": "={{ $json[\"SECTION_3_FarmerDetails/phoneNumber\"] }}"
            },
            {
              "name": "Seedlings",
              "value": "={{ $json[\"SECTION_3_FarmerDetails/seedlings\"] }}"
            },
            {
              "name": "Crops",
              "value": "={{ $json[\"SECTION_3_FarmerDetails/crops\"] }}"
            },
            {
              "name": "OtherCrops",
              "value": "={{ $json[\"SECTION_3_FarmerDetails/otherCrops\"] }}"
            },
            {
              "name": "SubmissionTime",
              "value": "={{ $json[\"_submission_time\"] }}"
            },
            {
              "name": "AcreAge",
              "value": "={{ $json[\"SECTION_3_FarmerDetails/acreage\"] }}"
            },
            {
              "name": "SubmittedBy",
              "value": "={{ $json[\"_submitted_by\"] }}"
            },
            {
              "name": "HouseGeopoint",
              "value": "={{ $json[\"SECTION_3_FarmerDetails/house_geopoint\"] }}"
            },
            {
              "name": "SiteBoundaries",
              "value": "={{ $json[\"Geo_Location_Visualization/SiteBoundaries\"] }}"
            },
            {
              "name": "SiteAreaByFo",
              "value": "={{ $json[\"Geo_Location_Visualization/siteAreaByFo\"] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "931e94bc-04f0-4f91-a344-01d137266a5c",
      "name": "Rename Keys and Set Needed Colums1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [
        420,
        840
      ]
    },
    {
      "parameters": {
        "table": "LANDING.KOBO.KENYA_HOUSEHOLD_SITE_STREAMED",
        "columns": "Id, StartTime,EndTime, Username, Region,District,Location,FirstName,MiddleName,LastName,IDNumber,PhoneNumber,Seedlings,Crops,OtherCrops,SubmissionTime, AcreAge,SubmittedBy,HouseGeopoint,SiteBoundaries,SiteAreaByFo"
      },
      "id": "1ad924a6-d292-4f8f-88c9-7f1414521ca1",
      "name": "Snowflake1",
      "type": "n8n-nodes-base.snowflake",
      "typeVersion": 1,
      "position": [
        820,
        840
      ],
      "credentials": {
        "snowflake": {
          "id": "40",
          "name": "Snowflake account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "ReadFromKobo": {
      "main": [
        [
          {
            "node": "Rename Keys and Set Needed Colums1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Truncate Snowflake Table": {
      "main": [
        [
          {
            "node": "Get Geospatial data from Kobo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Run Weekly": {
      "main": [
        [
          {
            "node": "Truncate Snowflake Table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Geospatial data from Kobo": {
      "main": [
        [
          {
            "node": "Load in 1000 rows per batch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Load in 1000 rows per batch": {
      "main": [
        [
          {
            "node": "Rename Keys and Set Needed Colums",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rename Keys and Set Needed Colums": {
      "main": [
        [
          {
            "node": "Snowflake",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Snowflake": {
      "main": [
        [
          {
            "node": "Check if there is no item left",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check if there is no item left": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Load in 1000 rows per batch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rename Keys and Set Needed Colums1": {
      "main": [
        [
          {
            "node": "Snowflake1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {},
  "versionId": "532b3b7b-5470-407e-bc0d-00c093c6e159",
  "id": "86",
  "meta": {
    "instanceId": "8129230d7b5838e2bdcc7901d37f050294755dc86702bf89cf084f6e0c51ec3a"
  },
  "tags": []
}